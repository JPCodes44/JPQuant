import numpy as np
import matplotlib.pyplot as plt
from scipy.signal import find_peaks

# The segment you provided
segment = np.array(
    [
        1169.55,
        1166.54,
        1168.46,
        1173.95,
        1174.54,
        1176.26,
        1175.61,
        1175.16,
        1174.3,
        1172.81,
        1171.62,
        1172.13,
        1176.0,
        1176.98,
        1176.35,
        1174.75,
        1173.96,
        1172.0,
        1174.77,
        1173.74,
        1171.0,
        1170.99,
        1166.47,
        1165.44,
        1164.08,
        1164.81,
        1165.26,
        1160.71,
        1157.97,
        1158.3,
        1161.1,
        1157.6,
        1158.75,
        1158.43,
        1158.02,
        1163.66,
        1164.36,
        1160.84,
        1160.87,
        1159.38,
        1158.2,
        1158.6,
        1158.55,
        1157.83,
        1160.99,
        1156.77,
        1152.8,
        1154.68,
        1153.96,
        1157.74,
        1159.0,
        1159.75,
        1157.68,
        1163.64,
        1168.74,
        1169.17,
        1169.58,
        1171.16,
        1172.33,
        1170.39,
        1171.38,
        1172.65,
        1170.44,
        1170.13,
        1170.57,
        1166.63,
        1165.23,
        1163.62,
        1161.05,
        1159.5,
        1158.44,
        1156.49,
        1154.99,
        1153.33,
        1155.85,
        1152.74,
        1144.58,
        1148.44,
        1147.69,
        1144.66,
        1146.58,
        1148.89,
        1151.63,
        1150.05,
        1144.61,
        1148.18,
        1146.12,
        1142.89,
        1139.71,
        1132.43,
        1127.33,
        1130.9,
        1134.79,
        1137.04,
        1141.31,
        1148.11,
        1149.98,
        1155.57,
        1157.2,
        1153.8,
        1157.47,
        1156.16,
        1158.07,
        1159.99,
        1161.79,
        1163.04,
        1163.88,
        1167.45,
        1167.61,
        1165.75,
        1163.94,
        1168.52,
        1166.87,
        1163.0,
        1163.02,
        1162.29,
        1162.45,
        1161.64,
        1164.17,
        1170.0,
        1172.13,
        1168.27,
        1169.46,
        1168.7,
        1169.4,
        1169.76,
        1169.55,
        1173.51,
        1179.22,
        1178.01,
        1174.0,
        1174.45,
        1174.2,
        1172.75,
        1172.09,
        1176.42,
        1173.31,
        1174.29,
        1181.58,
        1181.13,
        1176.52,
        1176.41,
        1173.73,
        1173.09,
        1171.61,
        1171.37,
        1171.82,
        1175.97,
        1173.55,
        1173.02,
    ]
)

# Scaled prominence
scaled_prominence = max(0.0001 * abs(np.mean(segment)), 1e-6)

# Find peaks
peaks, _ = find_peaks(segment, prominence=scaled_prominence)

# Plotting
plt.figure(figsize=(14, 6))
plt.plot(segment, label="Price Segment")
plt.plot(peaks, segment[peaks], "x", label="Detected Peaks", color="red")
for p in peaks:
    plt.annotate(
        f"{segment[p]:.2f}",
        (p, segment[p]),
        textcoords="offset points",
        xytext=(0, 10),
        ha="center",
    )
plt.title("Detected Peaks with Scipy's find_peaks")
plt.xlabel("Index")
plt.ylabel("Price")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.show()
